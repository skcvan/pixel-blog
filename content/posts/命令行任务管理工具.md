+++
date = '2025-12-09T14:30:26+08:00'
draft = true
title = 'å‘½ä»¤è¡Œä»»åŠ¡ç®¡ç†å·¥å…·ï¼ˆCLI To-Do Listï¼‰'
+++

 

## åŠŸèƒ½éœ€æ±‚

Â æ”¯æŒ`add`ï¼ˆæ·»åŠ ä»»åŠ¡ï¼‰ã€`list`ï¼ˆåˆ—å‡ºä»»åŠ¡ï¼‰ã€`done`ï¼ˆæ ‡è®°å®Œæˆï¼‰ã€‚

## è®¾è®¡æ€è·¯

1. é€šè¿‡os.Argsæ¥è¯»å–å¹¶è§£æå‘½ä»¤è¡Œå‚æ•°
2. è¯»å–os.Args[1]ç„¶åé€šè¿‡swtichåˆ†å‘ç»™add/list/done
3. æ ¸å¿ƒå‡½æ•°loadTasks()å’ŒsaveTasks()åˆ†åˆ«åŠ è½½å’Œä¿å­˜ä»»åŠ¡ï¼ˆæ•°æ®å­˜å‚¨åœ¨jsonæ–‡ä»¶ä¸­ï¼‰

## æ•°æ®æ¨¡å‹

å®šä¹‰Taskç»“æ„ä½“ï¼ŒåŒ…å«Descriptionï¼ˆä»»åŠ¡å†…å®¹ï¼‰ï¼ŒCreatedAtï¼ˆåˆ›å»ºæ—¶é—´ï¼‰ï¼ŒIsDoneï¼ˆæ˜¯å¦å®Œæˆï¼‰

## å…·ä½“æµç¨‹

### 1.é¦–å…ˆå®šä¹‰ç»“æ„ä½“

```jsx
type Task struct {
    Description string `json:"description"` // ä»»åŠ¡æè¿°
    CreatedAt   string `json:"createdAt"`   // åˆ›å»ºæ—¶é—´
    IsDone      bool   `json:"isDone"`      // æ˜¯å¦å®Œæˆ
}
```

åé¢çš„jsonå­—æ®µæ˜¯ä¸ºäº†æ·»åŠ æ˜ å°„ï¼Œè¿™é‡Œéœ€è¦è¡¥å……jsonåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„çŸ¥è¯†ï¼Œ

åœ¨ Go è¯­è¨€ä¸­ï¼Œè¿›è¡Œ JSON æ“ä½œæ—¶ï¼Œç»“æ„ä½“çš„**å­—æ®µå**éœ€è¦æ»¡è¶³ JSON çš„è§„èŒƒï¼Œè¿™æ¶‰åŠåˆ° **ç»“æ„ä½“æ ‡ç­¾ï¼ˆStruct Tagsï¼‰**ã€‚

- **é—®é¢˜ï¼š** ä½ çš„ç»“æ„ä½“å­—æ®µåä½¿ç”¨äº† Go è¯­è¨€æƒ¯ç”¨çš„**å¤§é©¼å³°å‘½å**ï¼ˆå¦‚ `Desription`ï¼‰ã€‚ä½†åœ¨ JSON æ–‡ä»¶ä¸­ï¼Œé€šç”¨æƒ¯ä¾‹æ˜¯ä½¿ç”¨ **å°å†™æˆ–è›‡å½¢å‘½å**ï¼ˆå¦‚ `description`ï¼‰ã€‚
- **è§£å†³æ–¹æ¡ˆï¼š** æˆ‘ä»¬éœ€è¦ä½¿ç”¨ `json:"fieldName"` æ ‡ç­¾æ¥æŒ‡å¯¼ `encoding/json` åŒ…è¿›è¡Œæ­£ç¡®çš„æ˜ å°„ã€‚

### 2.å¤„ç†å‘½ä»¤è¡Œå‚æ•°ä»¥åŠå‘½ä»¤è¡Œåˆ†å‘ä»£ç 

- `os.Args[0]`ï¼šæ°¸è¿œæ˜¯ç¨‹åºçš„åç§°ï¼ˆä¾‹å¦‚ï¼š`./todo`ï¼‰
- `os.Args[1]`ï¼šæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³å‘½ä»¤ï¼ˆä¾‹å¦‚ï¼š`add`ï¼‰
- `os.Args[2:]`ï¼šæ˜¯å‘½ä»¤åé¢çš„æ‰€æœ‰å‚æ•°

```jsx
func main() {
  //æ£€æŸ¥å‚æ•°é•¿åº¦
    if len(os.Args) < 2 {
        fmt.Println("ç”¨æ³•: todo <å‘½ä»¤> [å‚æ•°]")
        fmt.Println("å‘½ä»¤: add, list, done")
        return 
    }

    command := os.Args[1]

    // ä½¿ç”¨ switch ç»“æ„æ¥åˆ†å‘å‘½ä»¤
    switch command {
    case "add":
        // ... æ·»åŠ ä»»åŠ¡é€»è¾‘
    case "list":
        // ... åˆ—å‡ºä»»åŠ¡é€»è¾‘
    case "done":
        // ... æ ‡è®°å®Œæˆé€»è¾‘
    default:
        fmt.Printf("æœªçŸ¥å‘½ä»¤: %s\n", command)
    }
}
```

### 3.å®ç°æ ¸å¿ƒå‡½æ•°loadTasks()å’ŒsaveTasks()

è¿™éƒ¨åˆ†æ¶‰åŠå¾ˆå¤šioæ“ä½œçš„å‡½æ•°ï¼Œä»¥åŠé”™è¯¯å¤„ç†çš„æ–¹å¼å’Œåºåˆ—åŒ–çš„çŸ¥è¯†ï¼ŒçŸ¥è¯†ç‚¹æ€»ç»“å¦‚ä¸‹

å¸¸ç”¨æ–‡ä»¶ I/O (Input/Output) æ“ä½œå‡½æ•°

| **å‡½æ•°/å¸¸é‡**                            | **ç±»å‹** | **åŠŸèƒ½**                         | **æ ¸å¿ƒä½œç”¨**                               |
| ------------------------------------ | ------ | ------------------------------ | -------------------------------------- |
| **`os.ReadFile(name)`**              | I/O è¯»å– | å¿«é€Ÿè¯»å–æ•´ä¸ªæ–‡ä»¶å†…å®¹ã€‚                    | è¿”å›æ–‡ä»¶çš„å…¨éƒ¨ `[]byte` å’Œ `error`ã€‚            |
| **`os.WriteFile(name, data, perm)`** | I/O å†™å…¥ | å°† `[]byte` æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œå¹¶è®¾ç½®æ–‡ä»¶æƒé™ã€‚     | å®ç°æ•°æ®çš„**æŒä¹…åŒ–**ï¼ˆä¿å­˜ï¼‰ã€‚                      |
| **`os.Stat(name)`**                  | æ–‡ä»¶ä¿¡æ¯   | è·å–æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆå¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰ï¼‰ã€‚            | ç”¨äºæ£€æŸ¥æ–‡ä»¶çŠ¶æ€æˆ–æ˜¯å¦å­˜åœ¨ã€‚                         |
| **`os.Remove(name)`**                | æ–‡ä»¶æ“ä½œ   | åˆ é™¤æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ã€‚                     | ç”¨äºæ¸…ç†æˆ–åˆ é™¤æ•°æ®ã€‚                             |
| **`os.Exit(code)`**                  | ç¨‹åºæ§åˆ¶   | ç«‹å³ç»ˆæ­¢ç¨‹åºè¿è¡Œã€‚                      | `os.Exit(0)` ä¸ºæ­£å¸¸é€€å‡ºï¼›`os.Exit(1)` ä¸ºé”™è¯¯é€€å‡ºã€‚ |
| **`os.IsNotExist(err)`**             | é”™è¯¯åˆ¤æ–­   | æ£€æŸ¥ä¼ å…¥çš„ `err` æ˜¯å¦æ˜¯**æ–‡ä»¶ä¸å­˜åœ¨**çš„ç³»ç»Ÿé”™è¯¯ã€‚ | ä¼˜é›…åœ°å¤„ç†ç¬¬ä¸€æ¬¡è¿è¡Œæˆ–æ–‡ä»¶ç¼ºå¤±çš„æƒ…å†µã€‚                    |

JSON åºåˆ—åŒ–ä¸ç»“æ„ä½“æ ‡ç­¾

| **å‡½æ•°**                                      | **ç±»å‹** | **ä½œç”¨**                                               | **é€‚ç”¨åœºæ™¯**                   |
| ------------------------------------------- | ------ | ---------------------------------------------------- | -------------------------- |
| **`json.Unmarshal(data, &v)`**              | ååºåˆ—åŒ–   | å°† `[]byte` æ ¼å¼çš„ JSON æ•°æ®è§£æå¹¶å¡«å……åˆ° **æŒ‡é’ˆæŒ‡å‘** çš„ Go å˜é‡ `v` ä¸­ã€‚ | **è¯»å–**å¤–éƒ¨æ•°æ®ï¼ˆå¦‚ API å“åº”ã€é…ç½®æ–‡ä»¶ï¼‰ã€‚ |
| **`json.Marshal(v)`**                       | åºåˆ—åŒ–    | å°† Go å˜é‡è½¬æ¢ä¸º**ç´§å‡‘çš„**ã€å•è¡Œçš„ JSON `[]byte`ã€‚                 | **å†™å…¥**ç½‘ç»œä¼ è¾“ï¼ˆAPI å“åº”ï¼‰ï¼Œè¿½æ±‚æ•ˆç‡ã€‚   |
| **`json.MarshalIndent(v, prefix, indent)`** | æ ¼å¼åŒ–åºåˆ—åŒ– | ç”Ÿæˆ **å¸¦ç¼©è¿›** çš„ JSON å­—ç¬¦ä¸²ï¼ˆç¾åŒ–è¾“å‡ºï¼‰ã€‚                         | **å†™å…¥**æœ¬åœ°æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€è°ƒè¯•æ—¥å¿—ã€‚      |
| **`json.NewDecoder` / `json.NewEncoder`**   | æµå¼å¤„ç†   | ç”¨äºå¤„ç†å¤§å‹ JSON æ–‡ä»¶æˆ–ç½‘ç»œæµï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®åˆ°å†…å­˜ã€‚                   | é«˜æ€§èƒ½ã€å¤§æ–‡ä»¶ I/Oã€‚               |

```jsx
// --- æ ¸å¿ƒå‡½æ•° 1: ä»æ–‡ä»¶ä¸­åŠ è½½ä»»åŠ¡åˆ—è¡¨ ---
func loadTasks() ([]Task, error) {
    // 1. å°è¯•è¯»å–æ–‡ä»¶å†…å®¹
    data, err := os.ReadFile(tasksFile)

    // 2. å¤„ç†æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ (è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡è¿è¡Œ)
    if os.IsNotExist(err) {
        return []Task{}, nil // è¿”å›ä¸€ä¸ªç©ºçš„åˆ‡ç‰‡å’Œ nil é”™è¯¯
    }
    // 3. å¤„ç†å…¶ä»– I/O é”™è¯¯
    if err != nil {
        return nil, err
    }

    // 4. ååºåˆ—åŒ– (Unmarshal) JSON æ•°æ®åˆ° []Task
    var tasks []Task
    if err := json.Unmarshal(data, &tasks); err != nil {
        return nil, fmt.Errorf("è§£æJSONå¤±è´¥: %w", err)
    }
    return tasks, nil
}

// --- æ ¸å¿ƒå‡½æ•° 2: å°†ä»»åŠ¡åˆ—è¡¨ä¿å­˜åˆ°æ–‡ä»¶ ---
func saveTasks(tasks []Task) error {
    // 1. åºåˆ—åŒ– (Marshal) []Task åˆ° JSON æ ¼å¼ (ä½¿ç”¨ MarshalIndent æ ¼å¼åŒ–è¾“å‡º)
    data, err := json.MarshalIndent(tasks, "", "  ")
    if err != nil {
        return fmt.Errorf("JSONåºåˆ—åŒ–å¤±è´¥: %w", err)
    }

    // 2. å†™å…¥æ–‡ä»¶ (æƒé™ 0644 è¡¨ç¤ºç”¨æˆ·å¯è¯»å†™)
    return os.WriteFile(tasksFile, data, 0644)
}
```

### `data, err := json.MarshalIndent(tasks, "", " ")`

è¿™è¡Œä»£ç ä½¿ç”¨äº† Go è¯­è¨€çš„**å¤šé‡èµ‹å€¼**ï¼š

- **`data []byte`ï¼š** å˜é‡ `data` å­˜å‚¨ `json.MarshalIndent` å‡½æ•°çš„ç¬¬ä¸€ä¸ªè¿”å›å€¼ï¼Œå³**åºåˆ—åŒ–åçš„ JSON å­—èŠ‚åˆ‡ç‰‡**ï¼ˆ`[]byte`ï¼‰ã€‚
- **`err error`ï¼š** å˜é‡ `err` å­˜å‚¨ç¬¬äºŒä¸ªè¿”å›å€¼ï¼Œå³æ“ä½œè¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿçš„**é”™è¯¯**ã€‚

è¿™ç§æ¨¡å¼ï¼ˆè¿”å› `ç»“æœ, é”™è¯¯`ï¼‰åœ¨ Go æ ‡å‡†åº“ä¸­æ˜¯æ— å¤„ä¸åœ¨çš„ï¼Œå…è®¸ä½ åœ¨ä¸€è¡Œä»£ç ä¸­æ¥æ”¶æ“ä½œç»“æœå¹¶ç«‹å³æ£€æŸ¥å…¶æ˜¯å¦å¤±è´¥ã€‚

### `json.MarshalIndent(tasks, "", " ")`

`json.MarshalIndent` å‡½æ•°ç”¨äºå°† Go æ•°æ®ç»“æ„è½¬æ¢ä¸ºæ ¼å¼åŒ–ï¼ˆå¸¦ç¼©è¿›ï¼‰çš„ JSON å­—èŠ‚åˆ‡ç‰‡ï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š

1. **`tasks []Task`ï¼š** è¦åºåˆ—åŒ–çš„ Go æ•°æ®ã€‚
2. **`prefix string` (ç¬¬äºŒä¸ªå‚æ•°ï¼Œç©ºçš„ `""`)ï¼š** å®šä¹‰ JSON **æ¯ä¸€è¡Œå‰ç¼€**ã€‚æˆ‘ä»¬ä¼ å…¥ç©ºå­—ç¬¦ä¸² `""`ï¼Œè¡¨ç¤ºè¡Œå‰ä¸åŠ ä»»ä½•å­—ç¬¦ã€‚
3. **`indent string` (ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå¸¦ç©ºæ ¼çš„ `" "`)ï¼š** å®šä¹‰ JSON **ç¼©è¿›å­—ç¬¦ä¸²**ã€‚æˆ‘ä»¬ä¼ å…¥ä¸¤ä¸ªç©ºæ ¼ `" "`ï¼Œè¡¨ç¤º JSON çš„æ¯ä¸ªå±‚çº§éƒ½ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼è¿›è¡Œç¼©è¿›ï¼Œè®©æ–‡ä»¶ç»“æ„æ¸…æ™°æ˜“è¯»ã€‚

è¿™é‡Œå±•ç¤ºç¬¬äºŒä¸‰å‚æ•°å¯¹jsonæ–‡ä»¶ä¸­è¯»å†™çš„å½±å“

äºŒä¸‰å‚æ•°éƒ½ä¸ºç©º

```jsx
[{"description":"è´­ä¹°ç‰›å¥¶","createdAt":"2025-12-08","isDone":false}]
```

ç¬¬äºŒä¸ªå‚æ•°ä¸º#ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¿©ç©ºæ ¼

```jsx
 # [
 #     {
 #         "description": "è´­ä¹°ç‰›å¥¶",
 #         "createdAt": "2025-12-08",
 #         "isDone": false
 #     }
 # ]
```

### 4.å®ç°add/list/doneå‡½æ•°

**ï¼ˆ1ï¼‰addå‡½æ•°**

é€šè¿‡æ–°å»ºæ–°çš„taskç»“æ„ä½“å­˜å‚¨æ–°ä»»åŠ¡

```jsx
case "add":
        if len(os.Args) < 3 {
            fmt.Println("âŒ é”™è¯¯: è¯·è¾“å…¥ä»»åŠ¡æè¿°ã€‚ç”¨æ³•: todo add <æè¿°>")
            os.Exit(1)
        }
        description := strings.Join(os.Args[2:], " ")
        newTask := Task{
            Description: description,
            CreatedAt:   time.Now().Format("2006-01-02 15:04:05"),//è§„å®šæ—¶é—´çš„æ ¼å¼
            IsDone:      false,
        }

        tasks, err := loadTasks()
        if err != nil {
            fmt.Fprintf(os.Stderr, "âŒ åŠ è½½ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        tasks = append(tasks, newTask) // Day 4: åˆ‡ç‰‡ append

        if err := saveTasks(tasks); err != nil {
            fmt.Fprintf(os.Stderr, "âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        fmt.Printf("âœ… ä»»åŠ¡æ·»åŠ æˆåŠŸ: %s\n", newTask.Description)
```

**ï¼ˆ2ï¼‰listå‡½æ•°**

```jsx
case "list":
        tasks, err := loadTasks()
        if err != nil {
            fmt.Fprintf(os.Stderr, "âŒ åŠ è½½ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        fmt.Println("\n--- å¾…åŠäº‹é¡¹åˆ—è¡¨ ---")
        if len(tasks) == 0 {
            fmt.Println("ğŸ‰ æ­å–œï¼Œä»»åŠ¡åˆ—è¡¨ä¸ºç©ºï¼")
            return
        }

        for i, t := range tasks {
            status := "[ ]"
            if t.IsDone {
                status = "[X]" 
            }
            // æ‰“å°æ ¼å¼: [çŠ¶æ€] åºå·. æè¿° (åˆ›å»ºæ—¶é—´)
            fmt.Printf("%s %d. %s (åˆ›å»ºäº: %s)\n", status, i+1, t.Description, t.CreatedAt)
        }
        fmt.Println("----------------------\n")
```

**ï¼ˆ3ï¼‰doneå‡½æ•°**

è¿™é‡Œç”¨åˆ°äº†strconvåŒ…ï¼Œè¿™ä¸ªåŒ…æ˜¯Go ä¸­ä¸“é—¨è´Ÿè´£åœ¨ **å­—ç¬¦ä¸²** å’Œ **åŸºæœ¬æ•°æ®ç±»å‹** ä¹‹é—´è¿›è¡Œè½¬æ¢çš„å·¥å…·ã€‚

| **å‡½æ•°**                           | **ä½œç”¨**          | **æ ¼å¼å’Œè¿”å›å€¼**                                                               |
| -------------------------------- | --------------- | ------------------------------------------------------------------------ |
| **`Atoi(s string)`**             | **å­—ç¬¦ä¸²è½¬æ•´æ•° (ç®€å†™)** | è½¬æ¢å­—ç¬¦ä¸² `s` ä¸º `int` ç±»å‹ã€‚æ˜¯æœ€å¸¸ç”¨çš„ç®€ä¾¿å½¢å¼ã€‚è¿”å› `(int, error)`ã€‚                        |
| **`ParseInt(s, base, bitSize)`** | **å­—ç¬¦ä¸²è½¬æ•´æ•° (é€šç”¨)** | `Atoi` çš„åº•å±‚å®ç°ã€‚å…è®¸ä½ æŒ‡å®š**è¿›åˆ¶**ï¼ˆ`base`ï¼Œå¦‚ 10 è¿›åˆ¶ã€16 è¿›åˆ¶ï¼‰å’Œ**ä½æ•°**ï¼ˆ`bitSize`ï¼Œå¦‚ 64 ä½ï¼‰ã€‚ |
| **`Itoa(i int)`**                | **æ•´æ•°è½¬å­—ç¬¦ä¸² (é€†å‘)** | å°† `int` è½¬æ¢ä¸ºå¯¹åº”çš„ `string`ã€‚ç”¨äºç¨‹åºéœ€è¦å°†æ•°å­—ç»“æœæ˜¾ç¤ºæˆ–å†™å…¥æ–‡ä»¶æ—¶ã€‚                             |

```jsx
case "done":
        if len(os.Args) < 3 {
            fmt.Println("âŒ é”™è¯¯: è¯·æŒ‡å®šè¦æ ‡è®°å®Œæˆçš„ä»»åŠ¡åºå·ã€‚ç”¨æ³•: todo done <åºå·>")
            os.Exit(1)
        }

        indexStr := os.Args[2]
        index, err := strconv.Atoi(indexStr) 
        //å­—ç¬¦ä¸²è½¬æ•´æ•°æ˜¯å¾ˆå±é™©çš„æ“ä½œï¼Œå¿…é¡»æ£€æŸ¥err
        if err != nil || index <= 0 {
            fmt.Println("âŒ é”™è¯¯: æ— æ•ˆçš„åºå·ã€‚è¯·è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°ã€‚")
            os.Exit(1)
        }

        tasks, err := loadTasks()
        if err != nil {
            fmt.Fprintf(os.Stderr, "âŒ åŠ è½½ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ
        if index > len(tasks) {
            fmt.Printf("âŒ é”™è¯¯: åºå· %d è¶…å‡ºåˆ—è¡¨èŒƒå›´ (%dä¸ªä»»åŠ¡)ã€‚\n", index, len(tasks))
            os.Exit(1)
        }

        // æ ‡è®°ä»»åŠ¡å®Œæˆ (åˆ‡ç‰‡ç´¢å¼•æ˜¯ index - 1)
        tasks[index-1].IsDone = true

        // ä¿å­˜åˆ—è¡¨
        if err := saveTasks(tasks); err != nil {
            fmt.Fprintf(os.Stderr, "âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        fmt.Printf("âœ… ä»»åŠ¡ %d: '%s' å·²æ ‡è®°ä¸ºå®Œæˆã€‚\n", index, tasks[index-1].Description)
```

## å®Œæ•´ä»£ç 

```jsx
package main

import (
    "encoding/json" // JSONåºåˆ—åŒ–/ååºåˆ—åŒ–
    "fmt"
    "os"      // æ–‡ä»¶I/Oå’Œå‘½ä»¤è¡Œå‚æ•°
    "strconv" // å­—ç¬¦ä¸²è½¬æ•´æ•° (ç”¨äº 'done' å‘½ä»¤)
    "strings" // å­—ç¬¦ä¸²å¤„ç† (ç”¨äº 'add' å‘½ä»¤)
    "time"    // æ—¶é—´æˆ³
)

// --- æ ¸å¿ƒé…ç½®ä¸ç»“æ„ä½“ ---

const tasksFile = "tasks.json"

// Task ç»“æ„ä½“ (Day 7 æ­¥éª¤ä¸€ä¸äºŒ)
type Task struct {
    Description string `json:"description"`
    CreatedAt   string `json:"createdAt"`
    IsDone      bool   `json:"isDone"`
}

// --- æ ¸å¿ƒå‡½æ•° 1: åŠ è½½ä»»åŠ¡ ---
func loadTasks() ([]Task, error) {
    data, err := os.ReadFile(tasksFile)
    if os.IsNotExist(err) {
        return []Task{}, nil // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºåˆ—è¡¨
    }
    if err != nil {
        return nil, err
    }

    var tasks []Task
    if err := json.Unmarshal(data, &tasks); err != nil {
        return nil, fmt.Errorf("è§£æJSONå¤±è´¥: %w", err)
    }
    return tasks, nil
}

// --- æ ¸å¿ƒå‡½æ•° 2: ä¿å­˜ä»»åŠ¡ ---
func saveTasks(tasks []Task) error {
    data, err := json.MarshalIndent(tasks, "", "  ")
    if err != nil {
        return fmt.Errorf("JSONåºåˆ—åŒ–å¤±è´¥: %w", err)
    }
    // å†™å…¥æ–‡ä»¶ï¼Œæƒé™ 0644
    return os.WriteFile(tasksFile, data, 0644)
}

// --- ä¸»é€»è¾‘ï¼šå‘½ä»¤åˆ†å‘ä¸å®ç° ---
func main() {
    if len(os.Args) < 2 {
        fmt.Println("ç”¨æ³•: todo <å‘½ä»¤> [å‚æ•°] (add, list, done)")
        os.Exit(0)
    }
    command := os.Args[1]

    switch command {
    // --- 1. ADD å‘½ä»¤å®ç° (Day 7 æ­¥éª¤å››) ---
    case "add":
        if len(os.Args) < 3 {
            fmt.Println("âŒ é”™è¯¯: è¯·è¾“å…¥ä»»åŠ¡æè¿°ã€‚ç”¨æ³•: todo add <æè¿°>")
            os.Exit(1)
        }
        description := strings.Join(os.Args[2:], " ")
        newTask := Task{
            Description: description,
            CreatedAt:   time.Now().Format("2006-01-02 15:04:05"),
            IsDone:      false,
        }

        tasks, err := loadTasks()
        if err != nil {
            fmt.Fprintf(os.Stderr, "âŒ åŠ è½½ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        tasks = append(tasks, newTask) // Day 4: åˆ‡ç‰‡ append

        if err := saveTasks(tasks); err != nil {
            fmt.Fprintf(os.Stderr, "âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        fmt.Printf("âœ… ä»»åŠ¡æ·»åŠ æˆåŠŸ: %s\n", newTask.Description)

    // --- 2. LIST å‘½ä»¤å®ç° (Day 7 æ­¥éª¤ä¸ƒ) ---
    case "list":
        tasks, err := loadTasks()
        if err != nil {
            fmt.Fprintf(os.Stderr, "âŒ åŠ è½½ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        fmt.Println("\n--- å¾…åŠäº‹é¡¹åˆ—è¡¨ ---")
        if len(tasks) == 0 {
            fmt.Println("ğŸ‰ æ­å–œï¼Œä»»åŠ¡åˆ—è¡¨ä¸ºç©ºï¼")
            return
        }

        for i, t := range tasks {
            status := "[ ]"
            if t.IsDone {
                status = "[X]"
            }
            // æ‰“å°æ ¼å¼: [çŠ¶æ€] åºå·. æè¿° (åˆ›å»ºæ—¶é—´) 
            fmt.Printf("%s %d. %s (åˆ›å»ºäº: %s)\n", status, i+1, t.Description, t.CreatedAt)
        }
        fmt.Println("----------------------\n")

    // --- 3. DONE å‘½ä»¤å®ç° ---
    case "done":
        if len(os.Args) < 3 {
            fmt.Println("âŒ é”™è¯¯: è¯·æŒ‡å®šè¦æ ‡è®°å®Œæˆçš„ä»»åŠ¡åºå·ã€‚ç”¨æ³•: todo done <åºå·>")
            os.Exit(1)
        }

        // å­—ç¬¦ä¸²è½¬æ•´æ•° (å¤ä¹ )
        indexStr := os.Args[2]
        index, err := strconv.Atoi(indexStr)
        if err != nil || index <= 0 {
            fmt.Println("âŒ é”™è¯¯: æ— æ•ˆçš„åºå·ã€‚è¯·è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°ã€‚")
            os.Exit(1)
        }

        tasks, err := loadTasks()
        if err != nil {
            fmt.Fprintf(os.Stderr, "âŒ åŠ è½½ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ
        if index > len(tasks) {
            fmt.Printf("âŒ é”™è¯¯: åºå· %d è¶…å‡ºåˆ—è¡¨èŒƒå›´ (%dä¸ªä»»åŠ¡)ã€‚\n", index, len(tasks))
            os.Exit(1)
        }

        // æ ‡è®°ä»»åŠ¡å®Œæˆ (åˆ‡ç‰‡ç´¢å¼•æ˜¯ index - 1)
        tasks[index-1].IsDone = true

        // ä¿å­˜åˆ—è¡¨
        if err := saveTasks(tasks); err != nil {
            fmt.Fprintf(os.Stderr, "âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥: %v\n", err)
            os.Exit(1)
        }

        fmt.Printf("âœ… ä»»åŠ¡ %d: '%s' å·²æ ‡è®°ä¸ºå®Œæˆã€‚\n", index, tasks[index-1].Description)

    default:
        fmt.Printf("âŒ æœªçŸ¥å‘½ä»¤: %s\n", command)
        os.Exit(1)
    }
}
```

## ä½¿ç”¨æ–¹å¼

```jsx
# 1. æ·»åŠ ä»»åŠ¡
$ go run main.go add å®Œæˆ Day 7 æ€»ç»“

# 2. æŸ¥çœ‹åˆ—è¡¨
$ go run main.go list

# 3. æ ‡è®°ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆ
$ go run main.go done 1
```

## æ€»ç»“

æœ¬æ¬¡æ·±åº¦åˆ†æçš„æ ¸å¿ƒåœ¨äºç†è§£ Go è¯­è¨€å¦‚ä½•å®ç°æ•°æ®åœ¨å†…å­˜å’Œæ–‡ä»¶ä¹‹é—´çš„å¾€è¿”

**1. æ–‡ä»¶æ“ä½œçš„ç¨³å®šæ€§ :**

- **èŒè´£åˆ†ç¦»ï¼š** æ˜ç¡®äº† `os.ReadFile` ç”¨äºè¯»ï¼Œ`os.WriteFile` ç”¨äºå†™ã€‚
- **å¥å£®æ€§ï¼š** å­¦ä¼šäº†ä½¿ç”¨ `os.IsNotExist(err)` ä¼˜é›…åœ°å¤„ç†æ–‡ä»¶ç¼ºå¤±ï¼ˆç¬¬ä¸€æ¬¡è¿è¡Œï¼‰çš„æƒ…å†µï¼Œé¿å…ç¨‹åºå´©æºƒã€‚

**2. æ•°æ®è½¬æ¢çš„æ¡¥æ¢:**

- **åºåˆ—åŒ–ï¼š** ä½¿ç”¨ `json.MarshalIndent` å°† Go å†…å­˜ä¸­çš„ `[]Task` **ç»“æ„ä½“**è½¬æ¢ä¸ºæ–‡ä»¶æ‰€éœ€çš„ JSON **å­—èŠ‚åˆ‡ç‰‡** (`[]byte`)ã€‚
- **ååºåˆ—åŒ–ï¼š** ä½¿ç”¨ `json.Unmarshal` å°†æ–‡ä»¶å†…å®¹è½¬æ¢å› Go çš„ `[]Task`ï¼ˆå¿…é¡»ä¼ é€’**æŒ‡é’ˆ**è¿›è¡Œä¿®æ”¹ï¼‰ã€‚
- **å¯è¯»æ€§ï¼š** ç†è§£äº† `json.MarshalIndent` ä¸­çš„å‚æ•°ï¼ˆ`""`, `" "`ï¼‰ç”¨äºç¾åŒ–è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚

**3. é”™è¯¯å¤„ç†é“¾æ¡:**

- ç†è§£äº† Go å‡½æ•°ä¸­ `(result, error)` çš„æ ‡å‡†è¿”å›å€¼æ¨¡å¼ã€‚
- æŒæ¡äº† `fmt.Errorf("... %w", err)` å ä½ç¬¦ï¼Œå®ƒèƒ½**åŒ…è£…**åº•å±‚é”™è¯¯ï¼Œç¡®ä¿åœ¨åº”ç”¨å±‚èƒ½è¿½è¸ªåˆ°å¤±è´¥çš„æ ¹æºã€‚
